jobs:
  check-names:
    runs-on: ubuntu-latest

    steps:
      - name: Detect branch name
        shell: bash
        run: |
        # Для push: GITHUB_REF_NAME, для PR: GITHUB_HEAD_REF
        BRANCH="${GITHUB_HEAD_REF:-${GITHUB_REF_NAME}}"
        echo "Branch: $BRANCH"

        # Твоя проверка имени ветки
        if echo "$BRANCH" | grep -Eq '^(feature|bugfix|docs|refactor|content|balance|ci)/[0-9]+-[A-Za-z0-9-]+(/[A-Za-z0-9_-]+)?$'; then
          echo "✅ Название ветки в порядке"
        else
          echo "::error::Неверное имя ветки."
          echo "Ожидается что-то вроде:"
          echo "  feature/123-short-title/ИмяФамилия"
          echo "  bugfix/124-fix-crash/ИмяФамилия"
          echo "  docs/123-some-doc/Автор"
          echo "  refactor/123-some-refactor/Автор"
          echo "  content/123-some-content/Автор"
          echo "  balance/123-some-change/Автор"
          echo "  ci/123-some-ci-change/Автор"
          exit 1
        fi

      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Check last commit message
        run: |
          LAST_COMMIT_MSG="$(git log -1 --pretty=%B | head -n1)"
          echo "Last commit message: $LAST_COMMIT_MSG"

          if echo "$LAST_COMMIT_MSG" | grep -Eq '#[0-9]+'; then
            echo "✅ В сообщении коммита есть номер задачи вида '#123'."
          else
            echo "::error::В сообщении коммита нет номера задачи вида '#123'."
            exit 1
          fi
